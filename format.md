# Описание формата сериализованных данных

## Общая структура

Сериализованные данные начинаются с номера версии кодировки длиной один байт за которой следуют
собственно данные:

```
version encoded_data
```

Здесь и далее [] - обозначает наличие компонента 0 или 1 раз, {} - наличие компонента 0 или более раз.

## Структура закодированных данных

Сериализованное значение состоит из двух частей: типа и данных.

```
type_id encoded_value
```

где 
- type_id - идентификатор типа сериализованного значения (длиной от 1 до 5 байт),
- encoded_value - байты сериализованного значения, структура которых зависит от его типа.

## Структура сериализованного значения

В зависимости от типа значения кодируются по разному.

### nil

Кодируется одним байтом: `&H10`

### bool

Кодируется одним байтом: `&H03` для true значений и `&H01` для false значения.

### uint8 (byte)

Кодируется одним байтом значения:

128
```
&H80
```

### int8

Кодируется одним байтом значения после преобразования его к положительному целому:

-128
```
&HFF
```

### string

Сначала идёт закодированная длина строки (от 1 до 9 байт), далее - байты строки:

```
encoded_str_length str_bytes
```

### func

Кодируется одним байтом:

nil
```
&H10
```

не nil
```
&H20
```

### interface{}

Идентификатор типа (длиной от 1 до 5 байт), затем закодированное значение интерфейса:

```go
value_type_id encoded_value
```

### *V (указатель)

Сериализованное значение состоит из закодированного значения на которое указывает указатель:

```
encoded_pointed_value
```

### struct

Сериализованное значение начинается с признака структуры длиной один байт, далее следует
список закодированных значений полей структуры (без их типа):

```
&H40 { encoded_field_value }
```

Список полей для сериализации и их порядок определяются значением тэга "codec" структуры, если он есть.
Если тэга нет, то кодируются все поля структуры в том же порядке в котором они определены. 

Поля у которых нет этого тэга, при условии что хотя бы у одного поля структуры есть тэг, не подлежат кодированию.

Доступные значения тэга:
- index - определяет порядок поля при кодировании;
- removed - определяет поле которое более не должно использоваться;
- migratedTo - задаёт индекс поля которое стало заменой текущему полю: 
  значение будет сконвертировано к новому типу, если это возможно.